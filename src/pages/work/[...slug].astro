---
import { getCollection } from 'astro:content';
import InsightLayout from '../../layouts/InsightLayout.astro';
import QuickContact from '../../components/QuickContact.astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
	const caseStudies = await getCollection('work');
	return caseStudies.map((study) => ({
		params: { slug: study.slug },
		props: { study },
	}));
}

type Props = {
	study: CollectionEntry<'work'>;
};

const { study } = Astro.props;
const { Content } = await study.render();

// Get category for metadata
const category = study.data.category 
	? study.data.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
	: 'OPERATIONAL INFRASTRUCTURE';
---

<InsightLayout title={`${study.data.title} | FirstLayer Digital`} description={study.data.description}>
	<main class="relative overflow-hidden bg-[var(--bg-page)]">
		<!-- Obsidian Background with Blueprint Grid -->
		<div class="fixed inset-0 -z-10">
			<div class="absolute inset-0 bg-[var(--bg-page)]"></div>
			<div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"></div>
			<div class="absolute top-1/4 right-1/4 w-96 h-96 bg-cyan-900/10 rounded-full blur-3xl"></div>
			<div class="absolute bottom-1/4 left-1/4 w-96 h-96 bg-blue-900/10 rounded-full blur-3xl"></div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16 md:py-20 relative z-10">
			<!-- Back Link -->
			<div class="mb-6 sm:mb-8">
				<a href="/work" class="inline-flex items-center gap-2 text-sm text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 font-medium transition-colors group font-mono">
					<svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
					</svg>
					Back to Work
				</a>
			</div>

			<!-- Two-Column Layout -->
			<div class="grid lg:grid-cols-4 gap-8 lg:gap-12">
				<!-- Main Content (75%) -->
				<div class="lg:col-span-3">
					<!-- Case Study Metadata Ribbon -->
					<div class="mb-6 sm:mb-8 bg-card/80 backdrop-blur-sm border border-stroke rounded-xl p-4 sm:p-5">
						<div class="flex flex-wrap items-center gap-3 sm:gap-4 text-xs sm:text-sm font-mono text-body">
							<span class="text-cyan-600 dark:text-cyan-400">[</span>
							<span class="text-cyan-600 dark:text-cyan-400">DEPT:</span> <span class="text-head">{category}</span>
							<span class="text-cyan-600 dark:text-cyan-400">//</span>
							<span class="text-cyan-600 dark:text-cyan-400">STATUS:</span> <span class="text-head">OPERATIONAL</span>
							<span class="text-cyan-600 dark:text-cyan-400">//</span>
							<span class="text-cyan-600 dark:text-cyan-400">ROI:</span> <span class="text-head">{study.data.result.includes('15') ? '15H/WEEK' : 'TBD'}</span>
							<span class="text-cyan-600 dark:text-cyan-400">]</span>
						</div>
					</div>

					<!-- Case Study Header -->
					<header class="mb-8 sm:mb-12">
						<h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-5xl 2xl:text-6xl font-bold text-slate-900 dark:text-white mb-4 sm:mb-6 leading-tight">
							{study.data.title}
						</h1>
						{study.data.result && study.data.result.includes('15') && (
							<div class="mb-8 sm:mb-12 relative bg-[var(--bg-card)] border-4 border-cyan-500 dark:border-cyan-400 rounded-xl sm:rounded-2xl p-8 sm:p-10 md:p-12 lg:p-16 shadow-2xl shadow-cyan-500/20">
								<div class="absolute inset-0 bg-[radial-gradient(#06b6d40d_1px,transparent_1px)] bg-[size:24px_24px] rounded-xl sm:rounded-2xl opacity-50"></div>
								<div class="relative z-10">
									<div class="text-xs sm:text-sm font-mono text-cyan-500 dark:text-cyan-400 uppercase tracking-widest mb-4 sm:mb-6 font-bold">ROI METRIC</div>
									<p class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl 2xl:text-7xl font-extrabold text-[var(--text-header)] leading-tight font-mono mb-6 sm:mb-8">
										15+ hours of executive labor reclaimed weekly
									</p>
									<div class="mt-6 sm:mt-8 text-lg sm:text-xl md:text-2xl text-[var(--text-body)] font-mono border-t border-[var(--stroke)] pt-6 sm:pt-8">
										<span class="text-cyan-500 dark:text-cyan-400 font-bold text-xl sm:text-2xl md:text-3xl">780+ hours annually</span> reclaimed for strategic decision-making
									</div>
								</div>
							</div>
						)}
						<p class="text-lg sm:text-xl md:text-xl lg:text-2xl text-slate-700 dark:text-slate-300 mb-6 leading-relaxed">
							{study.data.description}
						</p>
						<div class="flex flex-wrap gap-2">
							{study.data.techStack.map((tech) => (
								<span class="bg-slate-800/50 text-cyan-400 px-2.5 py-1 rounded-lg text-xs font-medium border border-slate-700 font-mono">
									{tech}
								</span>
							))}
						</div>
					</header>

					<!-- Case Study Content -->
					<article class="article-content mb-12">
						<Content />
					</article>

					<!-- Link to Operational Infrastructure Service (for operational-infrastructure category) -->
					{study.data.category === 'operational-infrastructure' && (
						<div class="mb-12 bg-[var(--bg-card)]/40 backdrop-blur-xl border border-cyan-500/30 dark:border-cyan-400/30 rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-lg relative overflow-hidden">
							<div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] opacity-50"></div>
							<div class="relative z-10">
								<h3 class="text-xl sm:text-2xl font-bold text-[var(--text-header)] mb-3 sm:mb-4 flex items-center gap-2 font-mono">
									<svg class="w-6 h-6 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
									</svg>
									RELATED SERVICE
								</h3>
								<p class="text-lg sm:text-xl text-[var(--text-body)] leading-relaxed font-semibold mb-4">
									Learn more about our Operational Infrastructure & Internal Tools services.
								</p>
								<a href="/services#operational-infrastructure" class="inline-flex items-center gap-2 bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-3 rounded-xl font-semibold hover:gap-3 transition-all text-sm sm:text-base font-mono">
									View Operational Infrastructure Services
									<span class="inline-block group-hover:translate-x-1 transition-transform">→</span>
								</a>
							</div>
						</div>
					)}

					<!-- ROI Highlight - Prominent -->
					<div class="bg-[var(--bg-card)]/40 backdrop-blur-xl border border-cyan-500/30 dark:border-cyan-400/30 rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-lg mb-12 relative overflow-hidden">
						<div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] opacity-50"></div>
						<div class="relative z-10">
							<h3 class="text-xl sm:text-2xl font-bold text-slate-950 dark:text-white mb-3 sm:mb-4 flex items-center gap-2 font-mono">
								<svg class="w-6 h-6 text-cyan-600 dark:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
								</svg>
								ROI METRIC
							</h3>
							<p class="text-lg sm:text-xl text-slate-950 dark:text-white leading-relaxed font-semibold">
								{study.data.result}
							</p>
						</div>
					</div>
				</div>

				<!-- Sidebar (25%) -->
				<aside class="lg:col-span-1 space-y-6">
					<!-- System Specs -->
					<div class="sticky top-24 space-y-6">
						<div class="bg-[var(--bg-card)] backdrop-blur-xl rounded-2xl sm:rounded-3xl p-6 sm:p-8 shadow-md shadow-xl border border-[var(--stroke)]">
							<h2 class="text-lg sm:text-xl font-bold text-slate-900 dark:text-white mb-4 sm:mb-6 uppercase tracking-wide font-mono">System Specs</h2>
							
							<div class="space-y-4 font-mono text-xs sm:text-sm">
								<div>
									<div class="text-slate-600 dark:text-slate-500 mb-1 uppercase tracking-wide">Technology Stack</div>
									<div class="text-slate-700 dark:text-slate-300 space-y-1">
										{study.data.techStack.map((tech) => (
											<div class="flex items-center gap-2">
												<span class="text-cyan-600 dark:text-cyan-400">•</span>
												<span class="text-slate-900 dark:text-white">{tech}</span>
											</div>
										))}
									</div>
								</div>

								<div class="pt-4 border-t border-slate-300 dark:border-slate-700">
									<div class="text-slate-600 dark:text-slate-500 mb-1 uppercase tracking-wide">Category</div>
									<div class="text-slate-900 dark:text-white">
										{category}
									</div>
								</div>

								<div class="pt-4 border-t border-slate-300 dark:border-slate-700">
									<div class="text-slate-600 dark:text-slate-500 mb-1 uppercase tracking-wide">Date</div>
									<div class="text-slate-900 dark:text-white">
										{study.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
									</div>
								</div>
							</div>
						</div>

						<!-- Quick Contact -->
						<QuickContact />
					</div>
				</aside>
			</div>
		</div>
	</main>
</InsightLayout>

<style>
	/* Article Typography - Engineering Report Aesthetic with Light/Dark Mode Support */
	.article-content {
		color: var(--text-body);
		line-height: 1.8;
	}

	.article-content h1 {
		font-size: 2.25rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2.5rem;
		margin-bottom: 1.5rem;
		line-height: 1.2;
	}

	.article-content h2 {
		font-size: 1.875rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2.5rem;
		margin-bottom: 1rem;
		line-height: 1.3;
		border-bottom: 1px solid var(--border);
		padding-bottom: 0.5rem;
	}

	.article-content h3 {
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2rem;
		margin-bottom: 0.75rem;
		line-height: 1.4;
		border-bottom: 1px solid var(--border);
		padding-bottom: 0.5rem;
	}

	.article-content p {
		margin-bottom: 1.5rem;
		line-height: 1.8;
		color: var(--text-body);
	}

	.article-content ul, .article-content ol {
		margin-bottom: 1.5rem;
		margin-left: 1.5rem;
		color: var(--text-body);
	}

	.article-content li {
		margin-bottom: 0.75rem;
		line-height: 1.8;
		position: relative;
		padding-left: 0.5rem;
	}

	.article-content ul li::marker {
		display: none; /* Hide default marker */
	}

	.article-content ul li::before {
		content: '→';
		position: absolute;
		left: -1.25rem;
		color: var(--accent-cyan);
		font-weight: 600;
	}

	.article-content strong {
		font-weight: 700;
		color: var(--text-header);
	}

	.article-content a {
		color: rgb(8 145 178); /* cyan-600 */
		text-decoration: underline;
		text-decoration-color: rgb(8 145 178 / 0.5);
		transition: all 0.2s;
	}

	.dark .article-content a {
		color: rgb(34 211 238); /* cyan-400 */
		text-decoration-color: rgb(34 211 238 / 0.5);
	}

	.article-content a:hover {
		color: rgb(14 116 144); /* cyan-700 */
		text-decoration-color: rgb(8 145 178);
	}

	.dark .article-content a:hover {
		color: rgb(103 232 249); /* cyan-300 */
		text-decoration-color: rgb(34 211 238);
	}

	/* Code Blocks - Theme-aware */
	.article-content code:not(pre code) {
		background-color: color-mix(in srgb, var(--bg-page) 90%, var(--bg-card));
		color: var(--text-header);
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		font-size: 0.875rem;
		font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
	}

	.article-content pre {
		background-color: color-mix(in srgb, var(--bg-card) 80%, transparent);
		border: 1px solid color-mix(in srgb, var(--accent-cyan) 30%, transparent);
		border-radius: 0.5rem;
		padding: 1rem;
		overflow-x: auto;
		margin-bottom: 1.5rem;
	}

	.article-content pre code {
		background: transparent;
		border: none;
		padding: 0;
		color: var(--text-body);
	}

	/* Blockquotes - Cyan Left Border with Theme-aware Background */
	.article-content blockquote {
		border-left: 4px solid var(--accent-cyan);
		background-color: color-mix(in srgb, var(--accent-cyan) 10%, transparent);
		padding: 1rem 1.5rem;
		margin: 1.5rem 0;
		border-radius: 0 0.5rem 0.5rem 0;
		color: var(--text-body);
		font-style: italic;
	}

	/* Technical Terms - Monospace for hardware, software, metrics */
	.article-content :global(code),
	.article-content :global(.tech-term),
	.article-content :global(.hardware),
	.article-content :global(.software),
	.article-content :global(.metric) {
		font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
		color: var(--text-header);
		font-weight: 600;
		background-color: color-mix(in srgb, var(--bg-page) 90%, var(--bg-card));
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
	}
</style>
