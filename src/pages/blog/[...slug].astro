---
import { getCollection } from 'astro:content';
import InsightLayout from '../../layouts/InsightLayout.astro';
import QuickContact from '../../components/QuickContact.astro';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
	const blogPosts = await getCollection('blog');
	return blogPosts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

type Props = {
	post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;
const { Content } = await post.render();

// Calculate reading time (average 200 words per minute)
// Estimate based on description and typical article length
const estimatedWords = post.data.description.split(/\s+/).length * 20; // Rough estimate
const readingTime = Math.max(5, Math.ceil(estimatedWords / 200));

// Get primary category from tags
const primaryCategory = post.data.tags && post.data.tags.length > 0 
	? post.data.tags[0].toUpperCase() 
	: 'TECHNICAL';
---

<InsightLayout title={`${post.data.title} | FirstLayer Digital`} description={post.data.description}>
	<main class="relative overflow-hidden bg-[var(--bg-page)]">
		<!-- Obsidian Background with Blueprint Grid -->
		<div class="fixed inset-0 -z-10">
			<div class="absolute inset-0 bg-[var(--bg-page)]"></div>
			<div class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"></div>
			<div class="absolute top-1/4 right-1/4 w-96 h-96 bg-cyan-900/10 rounded-full blur-3xl"></div>
			<div class="absolute bottom-1/4 left-1/4 w-96 h-96 bg-blue-900/10 rounded-full blur-3xl"></div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16 md:py-20 relative z-10">
			<!-- Back Link -->
			<div class="mb-6 sm:mb-8">
				<a href="/blog" class="inline-flex items-center gap-2 text-sm text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 font-medium transition-colors group font-mono">
					<svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
					</svg>
					Back to Insights
				</a>
			</div>

			<!-- Two-Column Layout -->
			<div class="grid lg:grid-cols-4 gap-8 lg:gap-12">
				<!-- Main Content (75%) -->
				<div class="lg:col-span-3">
					<!-- Article Metadata Ribbon -->
					<div class="mb-6 sm:mb-8 bg-[var(--bg-card)]/80 dark:bg-slate-950/60 backdrop-blur-sm border border-[var(--stroke)] dark:border-slate-800 rounded-xl p-4 sm:p-5">
						<div class="flex flex-wrap items-center gap-4 sm:gap-6 text-xs sm:text-sm font-mono text-slate-600 dark:text-slate-300">
							<div>
								<span class="text-slate-900 dark:text-white">{primaryCategory}</span>
							</div>
							<div>
								<span class="text-cyan-600 dark:text-cyan-400">DATE:</span> <span class="text-slate-900 dark:text-white">{post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
							</div>
							<div>
								<span class="text-cyan-600 dark:text-cyan-400">READ_TIME:</span> <span class="text-slate-900 dark:text-white">{readingTime} MIN</span>
							</div>
							{post.data.updatedDate && (
								<div>
									<span class="text-cyan-600 dark:text-cyan-400">UPDATED:</span> <span class="text-slate-900 dark:text-white">{post.data.updatedDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
								</div>
							)}
						</div>
					</div>

					<!-- Article Header -->
					<header class="mb-8 sm:mb-12">
						<h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-5xl 2xl:text-6xl font-bold text-[var(--text-header)] dark:text-white mb-4 sm:mb-6 leading-tight">
							{post.data.title}
						</h1>
						<p class="text-lg sm:text-xl md:text-xl lg:text-2xl text-[var(--text-body)] dark:text-slate-300 mb-6 leading-relaxed">
							{post.data.description}
						</p>
						<div class="flex flex-wrap items-center gap-3 text-sm text-slate-500 font-mono">
							<span>By {post.data.author}</span>
							{post.data.tags && post.data.tags.length > 0 && (
								<span class="text-slate-600">•</span>
							)}
							{post.data.tags && post.data.tags.length > 0 && (
								<div class="flex flex-wrap gap-2">
									{post.data.tags.map((tag) => (
										<span class="bg-slate-800/50 text-slate-300 px-2.5 py-1 rounded-lg text-xs border border-slate-700">
											{tag}
										</span>
									))}
								</div>
							)}
						</div>
					</header>

					<!-- Article Content -->
					<article class="article-content mb-12">
						<Content />
					</article>
				</div>

				<!-- Sidebar (25%) -->
				<aside class="lg:col-span-1">
					<QuickContact />
				</aside>
			</div>

		</div>
	</main>
</InsightLayout>

<style>
	/* Article Typography - Engineering Report Aesthetic with Light/Dark Mode Support */
	.article-content {
		color: var(--text-body);
		line-height: 1.8; /* leading-relaxed */
	}

	.article-content h1 {
		font-size: 2.25rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2.5rem;
		margin-bottom: 1.5rem;
		line-height: 1.2;
	}

	.article-content h2 {
		font-size: 1.875rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2.5rem;
		margin-bottom: 1.5rem;
		line-height: 1.3;
	}

	.article-content h3 {
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--text-header);
		margin-top: 2rem;
		margin-bottom: 1rem;
		line-height: 1.4;
	}

	.article-content p {
		margin-bottom: 2rem; /* mb-8 */
		line-height: 1.8; /* leading-relaxed */
		color: var(--text-body);
	}

	.article-content ul, .article-content ol {
		margin-bottom: 2rem;
		margin-left: 1.5rem;
		color: rgb(51 65 85); /* slate-700 */
	}

	.dark .article-content ul, .dark .article-content ol {
		color: rgb(203 213 225); /* slate-300 */
	}

	.article-content li {
		margin-bottom: 1rem;
		line-height: 1.875;
		position: relative;
		padding-left: 0.5rem;
	}

	.article-content ul li::marker {
		display: none; /* Hide default marker */
	}

	.article-content ul li::before {
		content: '→';
		position: absolute;
		left: -1.25rem;
		color: var(--accent-cyan);
		font-weight: 600;
	}

	.article-content strong {
		font-weight: 700;
		color: var(--text-header);
	}

	.article-content a {
		color: var(--accent-cyan);
		text-decoration: underline;
		text-decoration-color: color-mix(in srgb, var(--accent-cyan) 50%, transparent);
		transition: all 0.2s;
	}

	.article-content a:hover {
		color: color-mix(in srgb, var(--accent-cyan) 80%, black);
		text-decoration-color: var(--accent-cyan);
	}

	/* Code Blocks - Theme-aware (only for code inside pre tags) */

	.article-content pre {
		background-color: color-mix(in srgb, var(--bg-card) 80%, transparent);
		border: 1px solid color-mix(in srgb, var(--accent-cyan) 30%, transparent);
		border-radius: 0.5rem;
		padding: 1rem;
		overflow-x: auto;
		margin-bottom: 1.5rem;
	}

	.article-content pre code {
		background: transparent;
		border: none;
		padding: 0;
		color: var(--text-body);
	}

	/* Blockquotes - Cyan Left Border with Theme-aware Background */
	.article-content blockquote {
		border-left: 4px solid var(--accent-cyan);
		background-color: color-mix(in srgb, var(--accent-cyan) 10%, transparent);
		padding: 1rem 1.5rem;
		margin: 1.5rem 0;
		border-radius: 0 0.5rem 0.5rem 0;
		color: var(--text-body);
		font-style: italic;
	}

	/* Technical Terms - Monospace for hardware, software, metrics */
	.article-content :global(code),
	.article-content :global(.tech-term),
	.article-content :global(.hardware),
	.article-content :global(.software),
	.article-content :global(.metric) {
		font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
		color: var(--text-header);
		font-weight: 600;
		background-color: color-mix(in srgb, var(--bg-page) 90%, var(--bg-card));
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
	}

	/* Inline code styling - Light Mode: bg-slate-100 text-slate-900, Dark Mode: bg-slate-800 text-slate-100 */
	.article-content code:not(pre code) {
		background-color: rgb(241 245 249); /* slate-100 - Light Mode */
		color: rgb(15 23 42); /* slate-900 - Light Mode */
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		font-size: 0.875rem;
		font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
	}

	.dark .article-content code:not(pre code) {
		background-color: rgb(30 41 59); /* slate-800 - Dark Mode */
		color: rgb(241 245 249); /* slate-100 - Dark Mode */
	}

	/* Ensure all list items use cyan arrow */
	.article-content ol li::marker {
		display: none;
	}

	.article-content ol li::before {
		content: '→';
		position: absolute;
		left: -1.25rem;
		color: rgb(8 145 178); /* cyan-600 */
		font-weight: 600;
	}

	.dark .article-content ol li::before {
		color: rgb(34 211 238); /* cyan-400 */
	}

	.article-content ol li {
		position: relative;
		padding-left: 0.5rem;
	}
</style>
